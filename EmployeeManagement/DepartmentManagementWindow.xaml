<Window x:Class="EmployeeManagement.DepartmentManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quản lý phòng ban" Height="550" Width="900"
        WindowStartupLocation="CenterScreen">
    <DockPanel Margin="10">

        <TextBlock Text="Quản lý phòng ban"
                   FontSize="20" FontWeight="Bold"
                   Foreground="#007ACC"
                   DockPanel.Dock="Top"
                   Margin="0,0,0,10"/>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Danh sách phòng ban -->
            <StackPanel Grid.Row="0">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <Button Content="Thêm" Width="80" Margin="5" Background="#28A745" Foreground="White" Click="AddDepartment_Click"/>
                    <Button Content="Sửa" Width="80" Margin="5" Background="#17A2B8" Foreground="White" Click="EditDepartment_Click"/>
                    <Button Content="Xóa" Width="80" Margin="5" Background="#DC3545" Foreground="White" Click="DeleteDepartment_Click"/>
                </StackPanel>

                <DataGrid x:Name="DepartmentDataGrid"
                          AutoGenerateColumns="False"
                          ItemsSource="{Binding Departments}"
                          SelectedItem="{Binding SelectedDepartment, Mode=TwoWay}"
                          IsReadOnly="True"
                          Height="200">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding DepartmentId}" Width="50"/>
                        <DataGridTextColumn Header="Tên phòng ban" Binding="{Binding DepartmentName}" Width="200"/>
                        <DataGridTextColumn Header="Mô tả" Binding="{Binding Description}" Width="*"/>
                        <DataGridTextColumn Header="Ngày tạo" Binding="{Binding CreatedAt, StringFormat=d}" Width="120"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>

            <GroupBox Header="Nhân viên thuộc phòng ban" Margin="0,260,0,0" Grid.RowSpan="2">
                <DataGrid AutoGenerateColumns="False"
              ItemsSource="{Binding EmployeesInDepartment}"
              SelectedItem="{Binding SelectedEmployee}"
              IsReadOnly="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding EmployeeId}" Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Họ tên" Binding="{Binding FullName}" Width="200" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Giới tính" Binding="{Binding Gender}" Width="100" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Chức vụ" Binding="{Binding Position}" Width="150" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Lương" Binding="{Binding BaseSalary, StringFormat=N0}" Width="100" IsReadOnly="True"/>

                        <DataGridTemplateColumn Header="Phòng ban" Width="180">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Department.DepartmentName}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.Departments, RelativeSource={RelativeSource AncestorType=Window}}"
                                  DisplayMemberPath="DepartmentName"
                                  SelectedValuePath="DepartmentId"
                                  SelectedValue="{Binding DepartmentId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  SelectionChanged="DepartmentComboBox_SelectionChanged"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

        </Grid>
    </DockPanel>
</Window>
